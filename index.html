<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>タックスナップ アンケート</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@rive-app/canvas@2.7.0"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            brand: {
              50: '#ecfdf5',
              100: '#d1fae5',
              200: '#a7f3d0',
              300: '#6ee7b7',
              400: '#34d399',
              500: '#10b981',
              600: '#059669',
              700: '#047857',
              800: '#065f46',
              900: '#064e3b',
            }
          }
        }
      }
    }
  </script>
  <style>
    * { box-sizing: border-box; }
    body { font-family: "Noto Sans JP", sans-serif; }

    .step { display: none; opacity: 0; transform: translateX(40px); }
    .step.active { display: block; animation: slideIn 0.35s ease forwards; }
    .step.exit { display: block; animation: slideOut 0.25s ease forwards; }

    @keyframes slideIn {
      from { opacity: 0; transform: translateX(40px); }
      to   { opacity: 1; transform: translateX(0); }
    }
    @keyframes slideOut {
      from { opacity: 1; transform: translateX(0); }
      to   { opacity: 0; transform: translateX(-40px); }
    }

    .feedback-card {
      opacity: 0; transform: translateY(12px);
      animation: fadeUp 0.4s ease 0.15s forwards;
    }
    @keyframes fadeUp {
      to { opacity: 1; transform: translateY(0); }
    }

    .opt-btn {
      transition: all 0.15s ease;
      border: 2px solid #e5e7eb;
    }
    .opt-btn:hover { border-color: #10b981; background: #ecfdf5; }
    .opt-btn.selected {
      border-color: #059669; background: #d1fae5; color: #065f46;
    }
    .opt-btn.selected .check-icon { display: inline-flex; }
    .check-icon { display: none; }

    .progress-fill { transition: width 0.4s ease; }

    .education-card {
      opacity: 0; transform: scale(0.95);
      animation: popIn 0.4s ease 0.1s forwards;
    }
    @keyframes popIn {
      to { opacity: 1; transform: scale(1); }
    }

    .incentive-highlight {
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      border: 2px solid #f59e0b;
    }

    .snappy-bounce {
      animation: snappyBounce 2s ease-in-out infinite;
    }
    @keyframes snappyBounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">

  <!-- Header -->
  <header class="bg-white border-b border-gray-200 sticky top-0 z-50">
    <div class="max-w-md mx-auto px-4 py-3 flex items-center justify-between">
      <img src="taxnap_logo.png" alt="タックスナップ" class="h-6 w-auto object-contain">
      <span id="stepLabel" class="text-sm text-gray-400"></span>
    </div>
    <div class="h-1 bg-gray-100">
      <div id="progressBar" class="progress-fill h-full bg-brand-500" style="width:0%"></div>
    </div>
  </header>

  <!-- Main -->
  <main class="max-w-md mx-auto px-4 pt-8 pb-24">

    <!-- ========== INTRO ========== -->
    <div id="intro" class="step active">
      <!-- Hero section with gradient background -->
      <div class="bg-gradient-to-b from-brand-50 to-white rounded-2xl p-6 mb-5 text-center relative overflow-hidden">
        <div class="absolute top-3 left-4 text-2xl opacity-20 rotate-[-15deg]">📝</div>
        <div class="absolute top-2 right-5 text-xl opacity-20 rotate-[10deg]">✨</div>
        <div class="absolute bottom-4 right-3 text-lg opacity-15 rotate-[20deg]">💬</div>

        <canvas id="snappyIntro" width="224" height="224" class="w-28 h-28 mx-auto mb-2 relative z-10"></canvas>

        <!-- Speech bubble -->
        <div class="inline-block bg-white rounded-2xl rounded-bl-sm shadow-sm px-4 py-2 mb-4 relative">
          <p class="text-sm font-bold text-brand-700">あなたの声を聞かせてください!</p>
          <div class="absolute -bottom-1.5 left-6 w-3 h-3 bg-white rotate-45 shadow-sm"></div>
        </div>

        <h1 class="text-2xl font-bold text-gray-900 mb-1">かんたん2分アンケート</h1>
        <p class="text-gray-500 text-sm leading-relaxed">
          タックスナップをもっと良くするために<br>ぜひご協力ください
        </p>
      </div>

      <!-- Incentive - bigger and more eye-catching -->
      <div class="mb-5">
        <div class="incentive-highlight rounded-xl p-4 flex items-center gap-4">
          <span class="text-4xl">🎁</span>
          <div>
            <p class="text-base font-bold text-amber-900">抽選で30名様に</p>
            <p class="text-sm font-bold text-amber-800">Amazonギフト券 <span class="text-lg text-red-600">1,000円分</span></p>
          </div>
        </div>
      </div>

      <!-- Steps - card style -->
      <div class="space-y-2.5 mb-6">
        <div class="flex items-center gap-3 bg-white rounded-xl px-4 py-3 shadow-sm border border-gray-100">
          <span class="flex-shrink-0 w-8 h-8 bg-brand-500 text-white rounded-full flex items-center justify-center text-sm font-bold">1</span>
          <span class="text-sm font-medium text-gray-700">タップで質問に答えるだけ</span>
          <span class="ml-auto text-xs text-brand-600 font-bold bg-brand-50 px-2 py-0.5 rounded-full">2分</span>
        </div>
        <div class="flex items-center gap-3 bg-white rounded-xl px-4 py-3 shadow-sm border border-gray-100">
          <span class="flex-shrink-0 w-8 h-8 bg-brand-500 text-white rounded-full flex items-center justify-center text-sm font-bold">2</span>
          <span class="text-sm font-medium text-gray-700">あなたに合った情報をお届け</span>
          <span class="ml-auto text-lg">💡</span>
        </div>
        <div class="flex items-center gap-3 bg-white rounded-xl px-4 py-3 shadow-sm border border-gray-100">
          <span class="flex-shrink-0 w-8 h-8 bg-brand-500 text-white rounded-full flex items-center justify-center text-sm font-bold">3</span>
          <span class="text-sm font-medium text-gray-700">抽選でギフト券が当たる!</span>
          <span class="ml-auto text-lg">🎉</span>
        </div>
      </div>

      <button onclick="startSurvey()" class="w-full py-4 bg-brand-600 hover:bg-brand-700 text-white font-bold rounded-2xl text-lg transition shadow-lg shadow-brand-200 active:scale-[0.98]">
        アンケートに答える
      </button>
      <p class="text-center text-xs text-gray-400 mt-3">回答は匿名で処理されます</p>
    </div>

    <!-- ========== Q1: 職種 ========== -->
    <div id="q1" class="step">
      <button onclick="goBack()" class="flex items-center gap-1 text-sm text-gray-400 hover:text-gray-600 mb-4 transition">← 戻る</button>
      <h2 class="text-xl font-bold text-gray-900 mb-1">Q1. あなたのお仕事は？</h2>
      <p class="text-sm text-gray-500 mb-6">一つ選んでください</p>

      <div class="space-y-3" id="q1Options">
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="建設・土木・外構" onclick="selectSingle('q1_job', this)">
          <span class="text-xl">🔨</span>
          <span class="flex-1 text-sm font-medium text-gray-700">建設・土木・外構（一人親方）</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="美容・エステ・ネイル" onclick="selectSingle('q1_job', this)">
          <span class="text-xl">💇</span>
          <span class="flex-1 text-sm font-medium text-gray-700">美容師・ネイリスト・エステ</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="配送・ドライバー" onclick="selectSingle('q1_job', this)">
          <span class="text-xl">🚚</span>
          <span class="flex-1 text-sm font-medium text-gray-700">配送・ドライバー（軽貨物・Uber Eats等）</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="IT・Web系" onclick="selectSingle('q1_job', this)">
          <span class="text-xl">💻</span>
          <span class="flex-1 text-sm font-medium text-gray-700">IT・Web系（エンジニア・デザイナー等）</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="物販・せどり" onclick="selectSingle('q1_job', this)">
          <span class="text-xl">📦</span>
          <span class="flex-1 text-sm font-medium text-gray-700">物販・せどり（メルカリ・Amazon等）</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="生活サービス" onclick="selectSingle('q1_job', this)">
          <span class="text-xl">🏠</span>
          <span class="flex-1 text-sm font-medium text-gray-700">生活サービス（クリーニング・整体・修理等）</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="その他" onclick="selectSingle('q1_job', this)">
          <span class="text-xl">📝</span>
          <span class="flex-1 text-sm font-medium text-gray-700">その他</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
      </div>

      <div id="q1OtherInput" class="hidden mt-3">
        <input type="text" id="q1OtherText" placeholder="ご職業を入力してください"
          class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-sm focus:border-brand-500 focus:outline-none">
      </div>

      <div id="q1Next" class="hidden mt-6">
        <button onclick="goTo('q2')" class="w-full py-3 bg-brand-600 hover:bg-brand-700 text-white font-bold rounded-xl transition">
          次へ
        </button>
      </div>
    </div>

    <!-- ========== Q2: チャネル ========== -->
    <div id="q2" class="step">
      <button onclick="goBack()" class="flex items-center gap-1 text-sm text-gray-400 hover:text-gray-600 mb-4 transition">← 戻る</button>
      <h2 class="text-xl font-bold text-gray-900 mb-1">Q2. タックスナップを何で知りましたか？</h2>
      <p class="text-sm text-gray-500 mb-6">一つ選んでください</p>

      <div class="space-y-3" id="q2Options">
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="テレビCM" onclick="selectSingle('q2_channel', this); showNext('q2Next')">
          <span class="text-xl">📺</span>
          <span class="flex-1 text-sm font-medium text-gray-700">テレビCM</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="ラジオ・radiko・Spotify" onclick="selectSingle('q2_channel', this); showNext('q2Next')">
          <span class="text-xl">📻</span>
          <span class="flex-1 text-sm font-medium text-gray-700">ラジオ・radiko・Spotify</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="電車内広告" onclick="selectSingle('q2_channel', this); showNext('q2Next')">
          <span class="text-xl">🚃</span>
          <span class="flex-1 text-sm font-medium text-gray-700">電車内広告</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="YouTube・TVer" onclick="selectSingle('q2_channel', this); showNext('q2Next')">
          <span class="text-xl">▶️</span>
          <span class="flex-1 text-sm font-medium text-gray-700">YouTube・TVer</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="SNS" onclick="selectSingle('q2_channel', this); showNext('q2Next')">
          <span class="text-xl">📱</span>
          <span class="flex-1 text-sm font-medium text-gray-700">SNS（X・Instagram・Facebook・TikTokなど）</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="ネット検索" onclick="selectSingle('q2_channel', this); showNext('q2Next')">
          <span class="text-xl">🔍</span>
          <span class="flex-1 text-sm font-medium text-gray-700">ネット検索</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="ニュース・記事・ブログ" onclick="selectSingle('q2_channel', this); showNext('q2Next')">
          <span class="text-xl">📰</span>
          <span class="flex-1 text-sm font-medium text-gray-700">ニュース・記事・ブログ</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="知人の紹介" onclick="selectSingle('q2_channel', this); showNext('q2Next')">
          <span class="text-xl">🤝</span>
          <span class="flex-1 text-sm font-medium text-gray-700">知人の紹介</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="その他" onclick="selectSingle('q2_channel', this); showNext('q2Next')">
          <span class="text-xl">📝</span>
          <span class="flex-1 text-sm font-medium text-gray-700">その他</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
      </div>

      <div id="q2Next" class="hidden mt-6">
        <button onclick="goTo('q3')" class="w-full py-3 bg-brand-600 hover:bg-brand-700 text-white font-bold rounded-xl transition">
          次へ
        </button>
      </div>
    </div>

    <!-- ========== Q3: 確定申告の現在地 ========== -->
    <div id="q3" class="step">
      <button onclick="goBack()" class="flex items-center gap-1 text-sm text-gray-400 hover:text-gray-600 mb-4 transition">← 戻る</button>
      <h2 class="text-xl font-bold text-gray-900 mb-1">Q3. 今年の確定申告、どうする予定ですか？</h2>
      <p class="text-sm text-gray-500 mb-6">一つ選んでください</p>

      <div class="space-y-3" id="q3Options">
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="タックスナップでやる予定" onclick="selectSingle('q3_status', this); showNext('q3Next')">
          <span class="text-xl">📱</span>
          <span class="flex-1 text-sm font-medium text-gray-700">タックスナップでやる予定</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="他のツール・サービスで進めている" onclick="selectSingle('q3_status', this); showNext('q3Next')">
          <span class="text-xl">💻</span>
          <span class="flex-1 text-sm font-medium text-gray-700">他のツール・サービスで進めている（freee・マネーフォワード・弥生など）</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="税理士に依頼している・依頼予定" onclick="selectSingle('q3_status', this); showNext('q3Next')">
          <span class="text-xl">👔</span>
          <span class="flex-1 text-sm font-medium text-gray-700">税理士に依頼している・依頼予定</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="紙・e-Taxで自力でやる予定" onclick="selectSingle('q3_status', this); showNext('q3Next')">
          <span class="text-xl">📝</span>
          <span class="flex-1 text-sm font-medium text-gray-700">紙（手書き）やe-Taxで自力でやる予定</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="何でやるかまだ決めていない" onclick="selectSingle('q3_status', this); showNext('q3Next')">
          <span class="text-xl">🤷</span>
          <span class="flex-1 text-sm font-medium text-gray-700">何でやるかまだ決めていない</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="確定申告が必要かわからない・しない予定" onclick="selectSingle('q3_status', this); showNext('q3Next')">
          <span class="text-xl">🤔</span>
          <span class="flex-1 text-sm font-medium text-gray-700">確定申告が必要かわからない・しない予定</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
      </div>

      <div id="q3Next" class="hidden mt-6">
        <button onclick="goTo('q4')" class="w-full py-3 bg-brand-600 hover:bg-brand-700 text-white font-bold rounded-xl transition">
          次へ
        </button>
      </div>
    </div>

    <!-- ========== Q4: 登録モチベーション ========== -->
    <div id="q4" class="step">
      <button onclick="goBack()" class="flex items-center gap-1 text-sm text-gray-400 hover:text-gray-600 mb-4 transition">← 戻る</button>
      <h2 class="text-xl font-bold text-gray-900 mb-1">Q4. タックスナップに登録した理由は？</h2>
      <p class="text-sm text-gray-500 mb-6">一番近いものを一つ選んでください</p>

      <div class="space-y-3" id="q4Options">
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="気になって登録した" onclick="selectSingle('q4_motivation', this); showNext('q4Next')">
          <span class="text-xl">👀</span>
          <span class="flex-1 text-sm font-medium text-gray-700">気になったのでとりあえず登録してみた</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="比較検討で登録した" onclick="selectSingle('q4_motivation', this); showNext('q4Next')">
          <span class="text-xl">⚖️</span>
          <span class="flex-1 text-sm font-medium text-gray-700">他のツールと比較するために登録した</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="試してみたくて登録した" onclick="selectSingle('q4_motivation', this); showNext('q4Next')">
          <span class="text-xl">✨</span>
          <span class="flex-1 text-sm font-medium text-gray-700">良さそうだったので試してみたくて登録した</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="使うつもりで登録した" onclick="selectSingle('q4_motivation', this); showNext('q4Next')">
          <span class="text-xl">💪</span>
          <span class="flex-1 text-sm font-medium text-gray-700">タックスナップで確定申告しようと思って登録した</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
      </div>

      <div id="q4Next" class="hidden mt-6">
        <button onclick="goTo('q5')" class="w-full py-3 bg-brand-600 hover:bg-brand-700 text-white font-bold rounded-xl transition">
          次へ
        </button>
      </div>
    </div>

    <!-- ========== Q5: コアバリア ========== -->
    <div id="q5" class="step">
      <button onclick="goBack()" class="flex items-center gap-1 text-sm text-gray-400 hover:text-gray-600 mb-4 transition">← 戻る</button>
      <h2 class="text-xl font-bold text-gray-900 mb-1">Q5. トライアルをまだ始めていない一番の理由は？</h2>
      <p class="text-sm text-gray-500 mb-6">一番近いものを一つ選んでください</p>

      <div class="space-y-3" id="q5Options">
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="使う予定" onclick="selectBarrier(this)">
          <span class="text-xl">📅</span>
          <span class="flex-1 text-sm font-medium text-gray-700">使う予定だが、まだ確定申告に手をつけていない</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="料金が高い" onclick="selectBarrier(this)">
          <span class="text-xl">💰</span>
          <span class="flex-1 text-sm font-medium text-gray-700">料金が高い・費用が気になる</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="難しそう" onclick="selectBarrier(this)">
          <span class="text-xl">😰</span>
          <span class="flex-1 text-sm font-medium text-gray-700">使い方が難しそう・始めるハードルが高い</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="他ツールの方が良い" onclick="selectBarrier(this)">
          <span class="text-xl">🔄</span>
          <span class="flex-1 text-sm font-medium text-gray-700">今使っている他のツール・税理士の方が良かった（良さそう）</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="始め方がわからない" onclick="selectBarrier(this)">
          <span class="text-xl">❓</span>
          <span class="flex-1 text-sm font-medium text-gray-700">始め方・やり方がわからなかった</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="セキュリティ不安" onclick="selectBarrier(this)">
          <span class="text-xl">🔒</span>
          <span class="flex-1 text-sm font-medium text-gray-700">セキュリティや信頼性が不安だった</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="その他" onclick="selectBarrier(this)">
          <span class="text-xl">📝</span>
          <span class="flex-1 text-sm font-medium text-gray-700">その他</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
      </div>

      <div id="q5OtherInput" class="hidden mt-3">
        <input type="text" id="q5OtherText" placeholder="理由を入力してください"
          class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-sm focus:border-brand-500 focus:outline-none">
      </div>

      <div id="q5Next" class="hidden mt-6">
        <button onclick="goToQ6()" class="w-full py-3 bg-brand-600 hover:bg-brand-700 text-white font-bold rounded-xl transition">
          次へ
        </button>
      </div>
    </div>

    <!-- ========== Q6: バリア別深掘り ========== -->

    <!-- Q6-A: 使う予定（まだ手をつけていない） -->
    <div id="q6-timing" class="step">
      <button onclick="goBack()" class="flex items-center gap-1 text-sm text-gray-400 hover:text-gray-600 mb-4 transition">← 戻る</button>
      <h2 class="text-xl font-bold text-gray-900 mb-1">Q6. いつ頃始める予定ですか？</h2>
      <p class="text-sm text-gray-500 mb-4">一つ選んでください</p>

      <div class="education-card bg-amber-50 border border-amber-200 rounded-xl p-4 mb-6">
        <div class="flex items-start gap-3">
          <span class="text-2xl">📌</span>
          <div>
            <p class="text-sm font-bold text-amber-900 mb-1">確定申告の期限は3月16日</p>
            <p class="text-sm text-amber-800 leading-relaxed">今から始めれば<strong>1日10分の入力でOK</strong>。3月に慌てる必要はありません。</p>
          </div>
        </div>
      </div>

      <div class="space-y-3">
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white" data-value="2月中に始めたい" onclick="selectSingle('q6sub', this); showNext('q6-timingNext')">
          <span class="text-sm font-medium text-gray-700">2月中に始めたい</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white" data-value="3月に入ってから" onclick="selectSingle('q6sub', this); showNext('q6-timingNext')">
          <span class="text-sm font-medium text-gray-700">3月に入ってから</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white" data-value="ギリギリ（3月10日以降）" onclick="selectSingle('q6sub', this); showNext('q6-timingNext')">
          <span class="text-sm font-medium text-gray-700">ギリギリ（3月10日以降）</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white" data-value="まだ決めていない" onclick="selectSingle('q6sub', this); showNext('q6-timingNext')">
          <span class="text-sm font-medium text-gray-700">まだ決めていない</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
      </div>

      <div id="q6-timingNext" class="hidden mt-6">
        <button onclick="goTo('q7')" class="w-full py-3 bg-brand-600 hover:bg-brand-700 text-white font-bold rounded-xl transition">
          次へ
        </button>
      </div>
    </div>

    <!-- Q6-B: 料金が高い -->
    <div id="q6-price" class="step">
      <button onclick="goBack()" class="flex items-center gap-1 text-sm text-gray-400 hover:text-gray-600 mb-4 transition">← 戻る</button>
      <h2 class="text-xl font-bold text-gray-900 mb-1">Q6. 料金について教えてください</h2>
      <p class="text-sm text-gray-500 mb-4">一つ選んでください</p>

      <div class="education-card bg-blue-50 border border-blue-200 rounded-xl p-4 mb-4">
        <div class="flex items-start gap-3">
          <span class="text-2xl">💡</span>
          <div>
            <p class="text-sm font-bold text-blue-900 mb-1">ご存知でしたか？</p>
            <p class="text-sm text-blue-800 leading-relaxed mb-2">タックスナップは<strong>3月16日までトライアル無料</strong>でお使いいただけます。レシート撮影も仕訳もすべて無料。いつでもキャンセルできます。</p>
            <p class="text-sm text-blue-800 leading-relaxed">有料プランも<strong>かんたんプランなら年11,760円（月あたり980円）</strong>。確定申告ソフトの中でも手頃な価格です。</p>
          </div>
        </div>
      </div>

      <div class="education-card bg-green-50 border border-green-200 rounded-xl p-4 mb-6">
        <div class="flex items-start gap-3">
          <span class="text-2xl">🛡️</span>
          <div>
            <p class="text-sm font-bold text-green-900 mb-1">途中で勝手に課金されることはありません</p>
            <p class="text-sm text-green-800 leading-relaxed">銀行口座を連携しても、経費を入力しても、書類を作成しても、<strong>トライアル中は一切0円</strong>。課金はご自身で有料プランを選択したときだけです。</p>
          </div>
        </div>
      </div>

      <div class="space-y-3">
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="無料なのを知らなかった" onclick="selectSingle('q6sub', this); showNext('q6-priceNext')">
          <span class="flex-1 text-sm font-medium text-gray-700">知らなかった！無料なら試してみたい</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="有料プランの価格が気になる" onclick="selectSingle('q6sub', this); showNext('q6-priceNext')">
          <span class="flex-1 text-sm font-medium text-gray-700">知っていたが、最終的に有料になるのが気になる</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white flex items-center gap-3" data-value="他と比べて高い" onclick="selectSingle('q6sub', this); showNext('q6-priceNext')">
          <span class="flex-1 text-sm font-medium text-gray-700">他のサービスと比べて割高に感じる</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
      </div>

      <div id="q6-priceNext" class="hidden mt-6">
        <button onclick="goTo('q7')" class="w-full py-3 bg-brand-600 hover:bg-brand-700 text-white font-bold rounded-xl transition">
          次へ
        </button>
      </div>
    </div>

    <!-- Q6-C: 使い方が難しそう -->
    <div id="q6-difficulty" class="step">
      <button onclick="goBack()" class="flex items-center gap-1 text-sm text-gray-400 hover:text-gray-600 mb-4 transition">← 戻る</button>
      <h2 class="text-xl font-bold text-gray-900 mb-1">Q6. どのあたりが難しそうだと感じましたか？</h2>
      <p class="text-sm text-gray-500 mb-4">あてはまるものをすべて選んでください</p>

      <div class="education-card bg-brand-50 border border-brand-200 rounded-xl p-4 mb-4">
        <div class="flex items-start gap-3">
          <span class="text-2xl">📸</span>
          <div>
            <p class="text-sm font-bold text-brand-900 mb-1">会計知識は一切不要です</p>
            <p class="text-sm text-brand-800 leading-relaxed">勘定科目などの専門知識は不要。レシートを撮れば<strong>AIが自動で仕訳</strong>します。わからないことは<strong>24時間AIサポート</strong>に質問OK。有人サポートもあります。</p>
          </div>
        </div>
      </div>

      <div class="education-card bg-purple-50 border border-purple-200 rounded-xl p-4 mb-6">
        <div class="flex items-start gap-3">
          <span class="text-2xl">💬</span>
          <div>
            <p class="text-sm font-bold text-purple-900 mb-1">わからないことはAIチャットにすぐ聞けます</p>
            <p class="text-sm text-purple-800 leading-relaxed">「この経費は何に分類？」「この書類の書き方は？」など、アプリ内のAIチャットで<strong>24時間いつでも何回でも質問OK</strong>。簡単なチャットですぐ回答が返ってきます。</p>
          </div>
        </div>
      </div>

      <div class="space-y-3">
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white" data-value="初期設定・連携" onclick="toggleMulti('q6sub', this); showNext('q6-difficultyNext')">
          <span class="text-sm font-medium text-gray-700">初期設定や銀行連携</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white" data-value="経費・収入の入力" onclick="toggleMulti('q6sub', this); showNext('q6-difficultyNext')">
          <span class="text-sm font-medium text-gray-700">経費や収入の入力方法</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white" data-value="書類の作成" onclick="toggleMulti('q6sub', this); showNext('q6-difficultyNext')">
          <span class="text-sm font-medium text-gray-700">確定申告の書類作成</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white" data-value="専門用語" onclick="toggleMulti('q6sub', this); showNext('q6-difficultyNext')">
          <span class="text-sm font-medium text-gray-700">専門用語が多くてわからない</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white" data-value="何から始めるか不明" onclick="toggleMulti('q6sub', this); showNext('q6-difficultyNext')">
          <span class="text-sm font-medium text-gray-700">そもそも何から始めればいいかわからない</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
      </div>

      <!-- YouTube Live 相談会 -->
      <a href="https://www.youtube.com/live/KMdI3Agyink?si=yrMTMJ-RG30OPR8a" target="_blank" class="block mt-6 mb-4">
        <div class="bg-white border-2 border-red-200 rounded-xl overflow-hidden shadow-sm hover:shadow-md transition">
          <div class="bg-gradient-to-r from-red-600 to-red-500 px-4 py-2 flex items-center gap-2">
            <svg class="w-5 h-5 text-white" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814z"/><path d="M9.545 15.568V8.432L15.818 12l-6.273 3.568z" fill="#fff"/></svg>
            <span class="text-white text-xs font-bold">YouTube LIVE 相談会</span>
          </div>
          <div class="px-4 py-3">
            <p class="text-sm font-bold text-gray-900 mb-1">操作が不安な方へ！ライブで直接相談できます</p>
            <div class="flex items-center gap-2 mb-2">
              <span class="bg-red-100 text-red-700 text-xs font-bold px-2 py-0.5 rounded">次回</span>
              <span class="text-sm font-bold text-gray-800">2月20日(金) 12:00〜13:00</span>
            </div>
            <p class="text-xs text-gray-500">確定申告やタックスナップの使い方について、なんでもご質問いただけます</p>
          </div>
        </div>
      </a>

      <div id="q6-difficultyNext" class="hidden mt-6">
        <button onclick="goTo('q7')" class="w-full py-3 bg-brand-600 hover:bg-brand-700 text-white font-bold rounded-xl transition">
          次へ
        </button>
      </div>
    </div>

    <!-- Q6-D: 他ツール・税理士の方が良い -->
    <div id="q6-competitor" class="step">
      <button onclick="goBack()" class="flex items-center gap-1 text-sm text-gray-400 hover:text-gray-600 mb-4 transition">← 戻る</button>
      <h2 class="text-xl font-bold text-gray-900 mb-1">Q6. 現在お使い（検討中）のサービスは？</h2>
      <p class="text-sm text-gray-500 mb-4">一つ選んでください</p>

      <div class="education-card bg-orange-50 border border-orange-200 rounded-xl p-4 mb-6">
        <div class="flex items-start gap-3">
          <span class="text-2xl">⭐</span>
          <div>
            <p class="text-sm font-bold text-orange-900 mb-1">確定申告アプリNo.1</p>
            <p class="text-sm text-orange-800 leading-relaxed">App Store評価<strong>4.6</strong>。確定申告アプリランキング1位を獲得。<strong>最速1時間</strong>で確定申告が完了します。</p>
          </div>
        </div>
      </div>

      <div class="space-y-3" id="q6CompOptions">
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white" data-value="freee" onclick="selectSingle('q6sub', this); showQ6CompSub()">
          <span class="text-sm font-medium text-gray-700">freee</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white" data-value="マネーフォワード" onclick="selectSingle('q6sub', this); showQ6CompSub()">
          <span class="text-sm font-medium text-gray-700">マネーフォワード</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white" data-value="弥生" onclick="selectSingle('q6sub', this); showQ6CompSub()">
          <span class="text-sm font-medium text-gray-700">弥生（やよいの青色申告など）</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white" data-value="税理士" onclick="selectSingle('q6sub', this); showQ6CompSub()">
          <span class="text-sm font-medium text-gray-700">税理士</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white" data-value="e-Tax" onclick="selectSingle('q6sub', this); showQ6CompSub()">
          <span class="text-sm font-medium text-gray-700">e-Tax（国税庁サイト）</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white" data-value="その他のツール" onclick="selectSingle('q6sub', this); showQ6CompSub()">
          <span class="text-sm font-medium text-gray-700">その他</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
      </div>

      <div id="q6CompSub" class="hidden mt-6">
        <div class="education-card bg-blue-50 border border-blue-200 rounded-xl p-4 mb-4">
          <div class="flex items-start gap-3">
            <span class="text-2xl">📥</span>
            <div>
              <p class="text-sm font-bold text-blue-900 mb-1">他の会計ソフトからかんたんインポート!</p>
              <p class="text-sm text-blue-800 leading-relaxed">freee・マネーフォワード・弥生などのデータを<strong>そのままタックスナップに取り込めます</strong>。面倒なデータ移行は不要です。</p>
            </div>
          </div>
        </div>
        <p class="text-sm font-bold text-gray-900 mb-3">タックスナップに乗り換えない理由は？</p>
        <div class="space-y-3" id="q6CompSubOptions">
          <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white" data-value="データ移行が面倒" onclick="selectSingle('q6sub2', this); showNext('q6-competitorNext')">
            <span class="text-sm font-medium text-gray-700">データ移行が面倒そう</span>
            <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
          </button>
          <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white" data-value="今ので満足" onclick="selectSingle('q6sub2', this); showNext('q6-competitorNext')">
            <span class="text-sm font-medium text-gray-700">今のツール・税理士で十分満足している</span>
            <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
          </button>
          <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white" data-value="比較する時間がない" onclick="selectSingle('q6sub2', this); showNext('q6-competitorNext')">
            <span class="text-sm font-medium text-gray-700">比較する時間がない</span>
            <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
          </button>
          <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white" data-value="契約期間が残っている" onclick="selectSingle('q6sub2', this); showNext('q6-competitorNext')">
            <span class="text-sm font-medium text-gray-700">契約期間が残っている</span>
            <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
          </button>
        </div>
      </div>

      <div id="q6-competitorNext" class="hidden mt-6">
        <button onclick="goTo('q7')" class="w-full py-3 bg-brand-600 hover:bg-brand-700 text-white font-bold rounded-xl transition">
          次へ
        </button>
      </div>
    </div>

    <!-- Q6-E: セキュリティ・信頼性が不安 -->
    <div id="q6-security" class="step">
      <button onclick="goBack()" class="flex items-center gap-1 text-sm text-gray-400 hover:text-gray-600 mb-4 transition">← 戻る</button>
      <h2 class="text-xl font-bold text-gray-900 mb-1">Q6. 特にどの点が不安でしたか？</h2>
      <p class="text-sm text-gray-500 mb-4">あてはまるものをすべて選んでください</p>

      <div class="education-card bg-indigo-50 border border-indigo-200 rounded-xl p-4 mb-6">
        <div class="flex items-start gap-3">
          <span class="text-2xl">🔒</span>
          <div>
            <p class="text-sm font-bold text-indigo-900 mb-1">安心してお使いいただけます</p>
            <p class="text-sm text-indigo-800 leading-relaxed"><strong>金融機関レベルの暗号化</strong>でデータを保護。App Store評価<strong>4.6</strong>、確定申告アプリランキング1位。多くの方にご利用いただいています。</p>
          </div>
        </div>
      </div>

      <div class="space-y-3">
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white" data-value="個人情報の取り扱い" onclick="toggleMulti('q6sub', this); showNext('q6-securityNext')">
          <span class="text-sm font-medium text-gray-700">個人情報の取り扱いが不安</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white" data-value="銀行連携の安全性" onclick="toggleMulti('q6sub', this); showNext('q6-securityNext')">
          <span class="text-sm font-medium text-gray-700">銀行口座との連携が怖い</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white" data-value="会社の信頼性" onclick="toggleMulti('q6sub', this); showNext('q6-securityNext')">
          <span class="text-sm font-medium text-gray-700">運営会社の実績や信頼性がわからない</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
        <button class="opt-btn w-full text-left px-4 py-3 rounded-xl bg-white" data-value="データ消失の不安" onclick="toggleMulti('q6sub', this); showNext('q6-securityNext')">
          <span class="text-sm font-medium text-gray-700">入力したデータが消えないか不安</span>
          <span class="check-icon w-5 h-5 bg-brand-600 text-white rounded-full items-center justify-center text-xs">✓</span>
        </button>
      </div>

      <div id="q6-securityNext" class="hidden mt-6">
        <button onclick="goTo('q7')" class="w-full py-3 bg-brand-600 hover:bg-brand-700 text-white font-bold rounded-xl transition">
          次へ
        </button>
      </div>
    </div>

    <!-- Q6-F: 始め方がわからない / その他 -->
    <div id="q6-simple" class="step">
      <button onclick="goBack()" class="flex items-center gap-1 text-sm text-gray-400 hover:text-gray-600 mb-4 transition">← 戻る</button>
      <div class="education-card bg-brand-50 border border-brand-200 rounded-xl p-5 mb-4">
        <div class="flex items-start gap-3">
          <span class="text-2xl">🚀</span>
          <div>
            <p class="text-sm font-bold text-brand-900 mb-2">ここから3分で始められます</p>
            <p class="text-sm text-brand-800 leading-relaxed mb-1">1. アプリを開く</p>
            <p class="text-sm text-brand-800 leading-relaxed mb-1">2. レシートを1枚撮る</p>
            <p class="text-sm text-brand-800 leading-relaxed">3. AIが自動で仕訳完了！</p>
            <p class="text-xs text-brand-600 mt-2">3月16日までトライアル無料。初期設定も不要です。</p>
          </div>
        </div>
      </div>

      <div class="education-card bg-green-50 border border-green-200 rounded-xl p-4 mb-4">
        <div class="flex items-start gap-3">
          <span class="text-2xl">🛡️</span>
          <div>
            <p class="text-sm font-bold text-green-900 mb-1">途中で勝手に課金されることはありません</p>
            <p class="text-sm text-green-800 leading-relaxed">銀行口座を連携しても、経費を入力しても、<strong>トライアル中は一切0円</strong>。課金はご自身で有料プランを選択したときだけです。</p>
          </div>
        </div>
      </div>

      <div class="education-card bg-purple-50 border border-purple-200 rounded-xl p-4 mb-4">
        <div class="flex items-start gap-3">
          <span class="text-2xl">💬</span>
          <div>
            <p class="text-sm font-bold text-purple-900 mb-1">わからないことはAIチャットにすぐ聞けます</p>
            <p class="text-sm text-purple-800 leading-relaxed">アプリ内のAIチャットで<strong>24時間いつでも何回でも質問OK</strong>。「何から始めればいい？」もチャットで聞けば即回答。</p>
          </div>
        </div>
      </div>

      <!-- YouTube Live 相談会 -->
      <a href="https://www.youtube.com/live/KMdI3Agyink?si=yrMTMJ-RG30OPR8a" target="_blank" class="block mb-6">
        <div class="bg-white border-2 border-red-200 rounded-xl overflow-hidden shadow-sm hover:shadow-md transition">
          <div class="bg-gradient-to-r from-red-600 to-red-500 px-4 py-2 flex items-center gap-2">
            <svg class="w-5 h-5 text-white" viewBox="0 0 24 24" fill="currentColor"><path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814z"/><path d="M9.545 15.568V8.432L15.818 12l-6.273 3.568z" fill="#fff"/></svg>
            <span class="text-white text-xs font-bold">YouTube LIVE 相談会</span>
          </div>
          <div class="px-4 py-3">
            <p class="text-sm font-bold text-gray-900 mb-1">始め方がわからない方へ！ライブで直接相談できます</p>
            <div class="flex items-center gap-2 mb-2">
              <span class="bg-red-100 text-red-700 text-xs font-bold px-2 py-0.5 rounded">次回</span>
              <span class="text-sm font-bold text-gray-800">2月20日(金) 12:00〜13:00</span>
            </div>
            <p class="text-xs text-gray-500">確定申告やタックスナップの使い方について、なんでもご質問いただけます</p>
          </div>
        </div>
      </a>

      <button onclick="goTo('q7')" class="w-full py-3 bg-brand-600 hover:bg-brand-700 text-white font-bold rounded-xl transition">
        次へ（最後の質問）
      </button>
    </div>

    <!-- ========== Q7: 自由記述 ========== -->
    <div id="q7" class="step">
      <button onclick="goBack()" class="flex items-center gap-1 text-sm text-gray-400 hover:text-gray-600 mb-4 transition">← 戻る</button>
      <h2 class="text-xl font-bold text-gray-900 mb-1">Q7. 最後に、ご意見があれば教えてください</h2>
      <p class="text-sm text-gray-500 mb-6">任意（スキップOK）</p>

      <textarea id="q7Text" rows="4" placeholder="「これがあったら使いたい」「ここが不安」など、何でもお気軽にどうぞ"
        class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-sm focus:border-brand-500 focus:outline-none resize-none"></textarea>

      <!-- Email for lottery -->
      <div class="mt-6 bg-amber-50 border border-amber-200 rounded-xl p-4">
        <p class="text-sm font-bold text-amber-900 mb-1">🎁 抽選の当選連絡先</p>
        <p class="text-xs text-amber-700 mb-3">タックスナップにご登録のメールアドレスをご入力ください</p>
        <input id="emailInput" type="email" required placeholder="例：taro@example.com"
          class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-sm focus:border-brand-500 focus:outline-none"
          oninput="toggleSubmitBtn()">
        <p id="emailError" class="text-xs text-red-500 mt-1 hidden">メールアドレスを入力してください</p>
      </div>

      <button id="submitBtn" onclick="submitSurvey()" disabled
        class="w-full mt-6 py-3 bg-gray-300 text-gray-500 font-bold rounded-xl transition cursor-not-allowed">
        回答を送信する
      </button>
    </div>

    <!-- ========== COMPLETE ========== -->
    <div id="complete" class="step">
      <!-- Thank you hero -->
      <div class="bg-gradient-to-b from-brand-50 to-white rounded-2xl p-6 mb-5 text-center relative overflow-hidden">
        <div class="absolute top-3 left-4 text-2xl opacity-20 rotate-[-10deg]">🎉</div>
        <div class="absolute top-2 right-5 text-xl opacity-20 rotate-[15deg]">✨</div>
        <div class="absolute bottom-3 right-4 text-lg opacity-15 rotate-[20deg]">🙏</div>

        <canvas id="snappyComplete" width="192" height="192" class="w-24 h-24 mx-auto mb-2 relative z-10"></canvas>

        <!-- Speech bubble -->
        <div class="inline-block bg-white rounded-2xl rounded-bl-sm shadow-sm px-4 py-2 mb-3 relative">
          <p class="text-sm font-bold text-brand-700">ご協力ありがとうございます!</p>
          <div class="absolute -bottom-1.5 left-6 w-3 h-3 bg-white rotate-45 shadow-sm"></div>
        </div>

        <h2 class="text-2xl font-bold text-gray-900 mb-1">回答を受け付けました</h2>
        <p class="text-sm text-gray-500">あなたの声がサービス改善に役立ちます</p>
      </div>

      <!-- Campaign CTA -->
      <div class="bg-gradient-to-br from-brand-600 to-brand-700 rounded-2xl p-5 mb-4 text-white relative overflow-hidden shadow-lg shadow-brand-200">
        <div class="absolute top-0 right-0 w-24 h-24 bg-white/5 rounded-full -translate-y-8 translate-x-8"></div>
        <div class="absolute bottom-0 left-0 w-16 h-16 bg-white/5 rounded-full translate-y-6 -translate-x-6"></div>
        <div class="relative z-10">
          <p class="text-xs font-bold tracking-wide opacity-90 mb-1">🎉 確定申告キャンペーン中！</p>
          <p class="text-xl font-bold mb-1">3月16日まで無料トライアル!</p>
          <p class="text-xs opacity-80 mb-1">レシート撮影・仕訳・申告書作成がすべて無料</p>
          <p class="text-xs opacity-60 mb-4">※ 確定申告の提出・書類のエクスポートの際に料金が発生します</p>
          <button onclick="openTaxSnap()"
            class="w-full py-3.5 bg-white text-brand-700 text-sm font-bold rounded-xl text-center hover:bg-gray-50 transition shadow-lg active:scale-[0.98]">
            タックスナップを開く →
          </button>
        </div>
      </div>

      <!-- Barrier-specific CTA -->
      <div id="completeCta" class="bg-white border border-gray-100 rounded-2xl p-5 mb-4 shadow-sm">
        <p class="text-sm font-bold text-brand-900 mb-2" id="completeCtaTitle"></p>
        <p class="text-sm text-gray-600 leading-relaxed" id="completeCtaText"></p>
      </div>

      <!-- Lottery -->
      <div class="incentive-highlight rounded-2xl p-4 mb-4 flex items-center gap-4">
        <span class="text-3xl">🎁</span>
        <div>
          <p class="text-sm font-bold text-amber-900">抽選で30名様にギフト券 <span class="text-red-600">1,000円分</span></p>
          <p class="text-xs text-amber-700 mt-0.5">当選発表はメール送付をもって代えさせていただきます</p>
        </div>
      </div>

      <p class="text-center text-xs text-gray-400 mt-6">ご質問は <a href="mailto:info@taxnap.co.jp" class="underline hover:text-gray-600 transition">info@taxnap.co.jp</a> まで</p>
    </div>

    <!-- Loading overlay -->
    <div id="loadingOverlay" class="hidden fixed inset-0 bg-white/80 flex items-center justify-center z-50">
      <div class="text-center">
        <div class="inline-block w-8 h-8 border-4 border-brand-200 border-t-brand-600 rounded-full animate-spin mb-3"></div>
        <p class="text-sm text-gray-600">送信中...</p>
      </div>
    </div>

  </main>

  <script>
    // ===== Get email from URL param =====

    // ===== State =====
    const answers = {
      q1_job: '', q2_channel: '', q3_status: '', q4_motivation: '',
      q5_barrier: '', q6sub: '', q6sub2: '', q7_freetext: ''
    };
    let currentStep = 'intro';
    const navHistory = [];

    // ===== GAS Web App URL =====
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbyYhtrw5D_ALyjOz45fXsoJO4BJatrF2sUXKUlexVXfAIRNfWF8wDYhwtfM_wrYihqU/exec';

    // ===== Step navigation =====
    const totalSteps = 7;

    function getStepNumber(stepId) {
      if (stepId === 'intro') return 0;
      if (stepId === 'q1') return 1;
      if (stepId === 'q2') return 2;
      if (stepId === 'q3') return 3;
      if (stepId === 'q4') return 4;
      if (stepId === 'q5') return 5;
      if (stepId.startsWith('q6')) return 6;
      if (stepId === 'q7') return 7;
      if (stepId === 'complete') return 8;
      return 0;
    }

    function goTo(nextId) {
      navHistory.push(currentStep);
      transition(nextId);
    }

    function goBack() {
      if (navHistory.length === 0) return;
      const prevId = navHistory.pop();
      transition(prevId);
    }

    function transition(nextId) {
      const currentEl = document.getElementById(currentStep);
      const nextEl = document.getElementById(nextId);

      currentEl.classList.remove('active');
      currentEl.classList.add('exit');

      setTimeout(() => {
        currentEl.classList.remove('exit');
        nextEl.classList.add('active');
        currentStep = nextId;

        const stepNum = getStepNumber(nextId);
        const progress = Math.min(100, (stepNum / totalSteps) * 100);
        document.getElementById('progressBar').style.width = progress + '%';
        document.getElementById('stepLabel').textContent =
          nextId === 'complete' ? '完了' :
          nextId === 'intro' ? '' :
          Math.min(stepNum, totalSteps) + ' / ' + totalSteps;

        window.scrollTo({ top: 0, behavior: 'smooth' });
      }, 250);
    }

    function startSurvey() { goTo('q1'); }

    // ===== Helpers =====
    function showNext(elementId) {
      document.getElementById(elementId).classList.remove('hidden');
    }

    // ===== Single select =====
    function selectSingle(questionKey, btn) {
      const container = btn.closest('.space-y-3');
      container.querySelectorAll('.opt-btn').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      answers[questionKey] = btn.dataset.value;

      // Q1: show/hide other input + show next
      if (questionKey === 'q1_job') {
        const otherInput = document.getElementById('q1OtherInput');
        if (btn.dataset.value === 'その他') {
          otherInput.classList.remove('hidden');
          document.getElementById('q1OtherText').focus();
        } else {
          otherInput.classList.add('hidden');
        }
        showNext('q1Next');
      }
    }

    // ===== Multi select =====
    function toggleMulti(questionKey, btn) {
      btn.classList.toggle('selected');
      if (!Array.isArray(answers[questionKey])) answers[questionKey] = [];
      answers[questionKey] = [];
      const container = btn.closest('.space-y-3');
      container.querySelectorAll('.opt-btn.selected').forEach(b => {
        answers[questionKey].push(b.dataset.value);
      });
    }

    // ===== Q5: Barrier selection =====
    function selectBarrier(btn) {
      document.querySelectorAll('#q5Options .opt-btn').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      const val = btn.dataset.value;
      answers.q5_barrier = val;

      const otherInput = document.getElementById('q5OtherInput');
      if (val === 'その他') {
        otherInput.classList.remove('hidden');
        document.getElementById('q5OtherText').focus();
      } else {
        otherInput.classList.add('hidden');
      }

      showNext('q5Next');
    }

    // ===== Q5 → Q6 routing =====
    const barrierToQ6 = {
      '使う予定': 'q6-timing',
      '料金が高い': 'q6-price',
      '難しそう': 'q6-difficulty',
      '他ツールの方が良い': 'q6-competitor',
      '始め方がわからない': 'q6-simple',
      'セキュリティ不安': 'q6-security',
      'その他': 'q6-simple',
    };

    function goToQ6() {
      // Handle Q1 other text
      if (answers.q1_job === 'その他') {
        const otherText = document.getElementById('q1OtherText').value.trim();
        if (otherText) answers.q1_job = 'その他: ' + otherText;
      }
      // Handle Q5 other text
      if (answers.q5_barrier === 'その他') {
        const otherText = document.getElementById('q5OtherText').value.trim();
        if (otherText) answers.q5_barrier = 'その他: ' + otherText;
      }
      const key = answers.q5_barrier.startsWith('その他') ? 'その他' : answers.q5_barrier;
      const target = barrierToQ6[key] || 'q6-simple';
      goTo(target);
    }

    // ===== Q6-competitor sub =====
    function showQ6CompSub() {
      document.getElementById('q6CompSub').classList.remove('hidden');
    }

    // ===== Deep link =====
    function openTaxSnap() {
      const deepLink = 'taxnap:///billing';
      const isAndroid = /Android/i.test(navigator.userAgent);
      const iosStore = 'https://apps.apple.com/app/taxnap';
      const androidStore = 'https://play.google.com/store/apps/details?id=com.taxnap';
      const storeUrl = isAndroid ? androidStore : iosStore;

      // Try deep link first
      window.location.href = deepLink;

      // If still on page after 1.5s, app not installed → go to store
      setTimeout(() => {
        if (!document.hidden) {
          window.location.href = storeUrl;
        }
      }, 1500);
    }

    // ===== Completion screen CTA =====
    const barrierCta = {
      '使う予定': {
        title: '📅 今始めれば、3月に慌てません',
        text: '1日10分、レシートを撮り溜めるだけ。確定申告時期にはもう準備完了です。'
      },
      '料金が高い': {
        title: '💰 3月16日までトライアル無料です',
        text: 'レシート撮影も仕訳もすべて無料。まずは1枚撮ってみませんか？'
      },
      '難しそう': {
        title: '📸 会計知識ゼロでOK。サポートも充実',
        text: '勘定科目の知識は不要。24時間AIサポート＋有人サポートで安心です。'
      },
      '他ツールの方が良い': {
        title: '⭐ App Store評価4.6・確定申告アプリNo.1',
        text: '最速1時間で確定申告が完了。3月16日まで無料なのでリスクゼロで比較できます。'
      },
      '始め方がわからない': {
        title: '🚀 ここから3分で始められます',
        text: 'アプリを開いてレシートを1枚撮るだけ。初期設定も不要です。'
      },
      'セキュリティ不安': {
        title: '🔒 App Store評価4.6。安心の実績',
        text: '金融機関レベルの暗号化でデータを保護。確定申告アプリNo.1の信頼性です。'
      },
    };

    function updateCompletionScreen() {
      const key = answers.q5_barrier.startsWith('その他') ? '始め方がわからない' : answers.q5_barrier;
      const cta = barrierCta[key] || barrierCta['始め方がわからない'];
      document.getElementById('completeCtaTitle').textContent = cta.title;
      document.getElementById('completeCtaText').textContent = cta.text;
    }

    // ===== Email validation =====
    function toggleSubmitBtn() {
      const email = document.getElementById('emailInput').value.trim();
      const btn = document.getElementById('submitBtn');
      const valid = email && /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
      btn.disabled = !valid;
      btn.className = valid
        ? 'w-full mt-6 py-3 bg-brand-600 hover:bg-brand-700 text-white font-bold rounded-xl transition'
        : 'w-full mt-6 py-3 bg-gray-300 text-gray-500 font-bold rounded-xl transition cursor-not-allowed';
      document.getElementById('emailError').classList.toggle('hidden', email === '' || valid);
    }

    // ===== Submit =====
    async function submitSurvey() {
      const emailVal = document.getElementById('emailInput').value.trim();
      if (!emailVal || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(emailVal)) {
        document.getElementById('emailError').classList.remove('hidden');
        document.getElementById('emailInput').focus();
        return;
      }

      answers.q7_freetext = document.getElementById('q7Text').value.trim();

      const payload = {
        timestamp: new Date().toISOString(),
        email: emailVal,
        q1_job: answers.q1_job,
        q2_channel: answers.q2_channel,
        q3_status: answers.q3_status,
        q4_motivation: answers.q4_motivation,
        q5_barrier: answers.q5_barrier,
        q6_detail: Array.isArray(answers.q6sub) ? answers.q6sub.join(', ') : (answers.q6sub || ''),
        q6_competitor_reason: answers.q6sub2 || '',
        q7_freetext: answers.q7_freetext,
        user_agent: navigator.userAgent
      };

      document.getElementById('loadingOverlay').classList.remove('hidden');

      try {
        if (GAS_URL !== 'YOUR_GAS_WEB_APP_URL_HERE') {
          await fetch(GAS_URL, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
          });
        } else {
          console.log('Survey data (prototype):', payload);
          await new Promise(r => setTimeout(r, 500));
        }
      } catch (e) {
        console.error('Submit error:', e);
      }

      document.getElementById('loadingOverlay').classList.add('hidden');
      updateCompletionScreen();
      goTo('complete');
    }

    // ===== Reset all selections on page load (prevent browser cache restore) =====
    window.addEventListener('pageshow', function(e) {
      if (e.persisted) {
        // bfcache restore - full reset
        document.querySelectorAll('.opt-btn.selected').forEach(function(btn) {
          btn.classList.remove('selected');
        });
        // Re-hide all "Next" buttons
        document.querySelectorAll('[id$="Next"]').forEach(function(el) {
          if (el.id !== 'q1Next' || true) el.classList.add('hidden');
        });
        // Reset state
        Object.keys(answers).forEach(function(k) { answers[k] = ''; });
        currentStep = 'intro';
        navHistory.length = 0;
        // Show intro only
        document.querySelectorAll('.step').forEach(function(s) {
          s.classList.remove('active', 'exit');
        });
        document.getElementById('intro').classList.add('active');
        updateProgress();
      }
    });

    // ===== Rive animation =====
    function initRive(canvasId) {
      new rive.Rive({
        src: 'happy.riv',
        canvas: document.getElementById(canvasId),
        autoplay: true,
        fit: rive.Fit.Contain,
      });
    }
    initRive('snappyIntro');
    initRive('snappyComplete');
  </script>

</body>
</html>
